#! /usr/bin/env bash

SERVICE_NAME=identity-service
TAG=${TRAVIS_TAG:-$TRAVIS_COMMIT}

./gradlew init
./gradlew build
./gradlew test

docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD";
docker pull cshr/${SERVICE_NAME} || true

docker build -t cshr/${SERVICE_NAME}:latest .

docker tag cshr/${SERVICE_NAME}:latest cshr/${SERVICE_NAME}:${TAG}
docker push cshr/${SERVICE_NAME}
